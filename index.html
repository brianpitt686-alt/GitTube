<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GitTube</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: { extend: { fontFamily: { sans: ["Inter", "sans-serif"] } } },
    };
  </script>

  <!-- React & Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase Storage & Auth Modules -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    window.FirebaseImports = {
      initializeApp, getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged,
      getFirestore, collection, onSnapshot, addDoc, doc, updateDoc
    };

    window.firebaseEnabled = false;
    try {
      if (typeof __firebase_config !== 'undefined' && __firebase_config) {
        const config = JSON.parse(__firebase_config);
        window.firebaseAppInstance = initializeApp(config);
        window.firebaseAuthInstance = getAuth(window.firebaseAppInstance);
        window.firebaseDbInstance = getFirestore(window.firebaseAppInstance);
        window.firebaseAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        window.firebaseEnabled = true;
      }
    } catch(e) { console.warn("Firebase init failed", e); }
  </script>

  <!-- Smooth page + modal animations -->
  <style>
    /* small, smooth transitions */
    .fade-enter { opacity: 0; transform: translateY(8px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 220ms ease, transform 220ms ease; }

    .modal-enter { opacity: 0; transform: translateY(16px) scale(0.98); }
    .modal-enter-active { opacity: 1; transform: translateY(0) scale(1); transition: opacity 220ms ease, transform 220ms ease; }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #777; }
  </style>
</head>
<body class="bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-50 overflow-hidden">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Icons ---
    const MenuIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>;
    const SearchIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>;
    const UploadIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>;
    const PlayIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z" /></svg>;
    const HomeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>;
    const VideoIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
    const ThumbUpIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" /></svg>;
    const ThumbDownIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.714.211-1.412.608-2.006L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" /></svg>;
    const ShareIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>;
    const SunIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;
    const MoonIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>;
    const SubsIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>;
    const HistoryIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
    const LikeOutlineIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" /></svg>;

    // Utility to parse YouTube and Google Drive links into Embeds
    const parseVideoUrl = (url) => {
      let embedUrl = url;
      let isEmbed = false;
      let thumb = "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=640&q=80";

      try {
        const urlObj = new URL(url);
        if (urlObj.hostname.includes('youtube.com') || urlObj.hostname.includes('youtu.be')) {
          isEmbed = true;
          let videoId = '';
          if (urlObj.hostname.includes('youtu.be')) {
            videoId = urlObj.pathname.slice(1);
          } else if (url.includes('watch')) {
            videoId = urlObj.searchParams.get('v');
          } else if (url.includes('embed/')) {
            videoId = urlObj.pathname.split('embed/')[1];
          }
          if (videoId) {
            embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            thumb = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
          }
        } else if (urlObj.hostname.includes('drive.google.com')) {
          isEmbed = true;
          if (url.includes('/view')) {
            embedUrl = url.replace('/view', '/preview');
          }
        } else if (!url.endsWith('.mp4') && !url.endsWith('.webm')) {
          isEmbed = true;
        }
      } catch (e) {}
      return { embedUrl, isEmbed, thumb };
    };

    const formatTimeAgo = (timestamp) => {
      if (!timestamp) return "Just now";
      const seconds = Math.floor((Date.now() - timestamp) / 1000);
      let interval = seconds / 31536000;
      if (interval > 1) return Math.floor(interval) + (Math.floor(interval) === 1 ? " year ago" : " years ago");
      interval = seconds / 2592000;
      if (interval > 1) return Math.floor(interval) + (Math.floor(interval) === 1 ? " month ago" : " months ago");
      interval = seconds / 86400;
      if (interval > 1) return Math.floor(interval) + (Math.floor(interval) === 1 ? " day ago" : " days ago");
      interval = seconds / 3600;
      if (interval > 1) return Math.floor(interval) + (Math.floor(interval) === 1 ? " hour ago" : " hours ago");
      interval = seconds / 60;
      if (interval > 1) return Math.floor(interval) + (Math.floor(interval) === 1 ? " minute ago" : " minutes ago");
      if (seconds < 10) return "Just now";
      return Math.floor(seconds) + " seconds ago";
    };

    // --- Mock Data ---
    const initialVideos = [];
   
    const categories = ["All", "Gaming", "Coding", "Music", "Live", "Podcasts", "News"];

    function App() {
      const [user, setUser] = useState(null);
      const [videos, setVideos] = useState(initialVideos);
      const [searchQuery, setSearchQuery] = useState("");
      const [isUploadOpen, setIsUploadOpen] = useState(false);
      const [playingVideo, setPlayingVideo] = useState(null);
      const [viewingChannel, setViewingChannel] = useState(null);
      const [activeCategory, setActiveCategory] = useState("All");
      const [isDarkMode, setIsDarkMode] = useState(true);
      const [newComment, setNewComment] = useState("");

      useEffect(() => {
        if (!window.firebaseEnabled) return;
        const { signInWithCustomToken, signInAnonymously, onAuthStateChanged } = window.FirebaseImports;
        const auth = window.firebaseAuthInstance;

        const initAuth = async () => {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            await signInAnonymously(auth);
          }
        };
        initAuth();
        const unsubscribe = onAuthStateChanged(auth, setUser);
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        if (!window.firebaseEnabled || !user) return;
        const { collection, onSnapshot } = window.FirebaseImports;
        const db = window.firebaseDbInstance;
        const appId = window.firebaseAppId;

        // Fetch user uploads from Firestore to persist them across reloads
        const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'videos');
        const unsubscribe = onSnapshot(colRef, (snapshot) => {
           const dbVideos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
           const sortedDbVideos = dbVideos.sort((a,b) => b.createdAt - a.createdAt);
           setVideos([...sortedDbVideos, ...initialVideos]);
        }, (err) => console.error("FS Error", err));
       
        return () => unsubscribe();
      }, [user]);

      useEffect(() => {
        if (isDarkMode) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }, [isDarkMode]);

      // Upload State
      const [upTitle, setUpTitle] = useState("");
      const [upDesc, setUpDesc] = useState("");
      const [upChannel, setUpChannel] = useState("");
      const [upFile, setUpFile] = useState(null);
      const [uploadType, setUploadType] = useState('link'); // 'link' or 'file'
      const [upUrl, setUpUrl] = useState("");

      const handleUploadSubmit = async (e) => {
        e.preventDefault();
        if (!upTitle) return;

        const newVideo = {
          title: upTitle,
          desc: upDesc,
          channel: upChannel || "Anonymous", // Original Channel
          views: "0 views",
          date: "Just now",
          likes: 0,
          category: "Gaming",
          comments: [],
          createdAt: Date.now()
        };

        if (uploadType === 'link') {
          if (!upUrl) return;
          const { embedUrl, isEmbed, thumb } = parseVideoUrl(upUrl);
          newVideo.videoUrl = upUrl;
          newVideo.embedUrl = embedUrl;
          newVideo.isEmbed = isEmbed;
          newVideo.thumb = thumb;

          // Save link directly to Cloud DB so it persists on reload
          if (window.firebaseEnabled && user) {
            try {
              const { collection, addDoc } = window.FirebaseImports;
              const colRef = collection(window.firebaseDbInstance, 'artifacts', window.firebaseAppId, 'public', 'data', 'videos');
              await addDoc(colRef, newVideo);
            } catch(err) { console.error("Error saving doc", err); }
          } else {
            newVideo.id = Date.now().toString();
            setVideos([newVideo, ...videos]);
          }
        } else {
          // Local file uploads use object URLs which don't persist on reload
          if (!upFile) return;
          newVideo.id = Date.now().toString();
          newVideo.thumb = "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=640&q=80";
          newVideo.videoUrl = URL.createObjectURL(upFile);
          newVideo.isEmbed = false;
          setVideos([newVideo, ...videos]);
        }

        setIsUploadOpen(false);
        setUpTitle("");
        setUpDesc("");
        setUpChannel("");
        setUpUrl("");
        setUpFile(null);
      };

      const filteredVideos = videos.filter(v => {
        if (viewingChannel && v.channel !== viewingChannel) return false;
        const matchesSearch = v.title.toLowerCase().includes(searchQuery.toLowerCase()) || v.channel.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = activeCategory === "All" || v.category === activeCategory;
        return matchesSearch && matchesCategory;
      });

      const handleAddComment = async (e) => {
        e.preventDefault();
        if (!newComment.trim() || !playingVideo) return;
       
        const updatedVideo = { ...playingVideo, comments: [{ id: Date.now(), user: "Current User", text: newComment, createdAt: Date.now() }, ...playingVideo.comments] };
        setPlayingVideo(updatedVideo);
        setVideos(videos.map(v => v.id === playingVideo.id ? updatedVideo : v));
        setNewComment("");

        // Save comment to Cloud Database
        if (window.firebaseEnabled && user && playingVideo.id) {
          try {
            const { doc, updateDoc } = window.FirebaseImports;
            const docRef = doc(window.firebaseDbInstance, 'artifacts', window.firebaseAppId, 'public', 'data', 'videos', playingVideo.id);
            await updateDoc(docRef, { comments: updatedVideo.comments });
          } catch (err) { console.warn("Could not save comment to cloud (might be local file).", err); }
        }
      };

      const handleLike = async () => {
        if (!playingVideo) return;
        const newLikes = (playingVideo.likes || 0) + 1;
        const updatedVideo = { ...playingVideo, likes: newLikes };

        setPlayingVideo(updatedVideo);
        setVideos(videos.map(v => v.id === playingVideo.id ? updatedVideo : v));

        // Save like to Cloud Database
        if (window.firebaseEnabled && user && playingVideo.id) {
          try {
            const { doc, updateDoc } = window.FirebaseImports;
            const docRef = doc(window.firebaseDbInstance, 'artifacts', window.firebaseAppId, 'public', 'data', 'videos', playingVideo.id);
            await updateDoc(docRef, { likes: newLikes });
          } catch (err) { console.warn("Could not save like to cloud (might be local file).", err); }
        }
      };

      return (
        <div className="h-screen flex flex-col font-sans fade-enter-active">
          {/* Top Navbar */}
          <nav className="h-14 flex items-center justify-between px-4 border-b border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 z-10">
            <div className="flex items-center gap-4">
              <button className="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full transition-colors">
                <MenuIcon />
              </button>
              <div
                className="flex items-center gap-1.5 cursor-pointer"
                onClick={() => { setPlayingVideo(null); setViewingChannel(null); }}
              >
                <div className="w-7 h-7 bg-red-600 rounded-lg flex items-center justify-center text-white">
                  <PlayIcon />
                </div>
                <span className="text-xl font-bold tracking-tight hidden sm:block">GitTube</span>
              </div>
            </div>

            <div className="flex-1 max-w-2xl px-4 sm:px-12 flex items-center">
              <div className="flex w-full">
                <input
                  type="text"
                  placeholder="Search"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-l-full bg-neutral-50 dark:bg-neutral-900 focus:outline-none focus:border-blue-500"
                />
                <button className="px-5 border border-l-0 border-neutral-300 dark:border-neutral-700 rounded-r-full bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors">
                  <SearchIcon />
                </button>
              </div>
            </div>

            <div className="flex items-center gap-2 sm:gap-4">
              <button
                onClick={() => setIsDarkMode(!isDarkMode)}
                className="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full transition-colors hidden sm:block"
                title="Toggle Theme"
              >
                {isDarkMode ? <SunIcon /> : <MoonIcon />}
              </button>
              <button
                onClick={() => setIsUploadOpen(true)}
                className="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full transition-colors"
                title="Create"
              >
                <UploadIcon />
              </button>
              <div className="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm cursor-pointer">
                BP
              </div>
            </div>
          </nav>

          {/* Main Layout Area */}
          <div className="flex flex-1 overflow-hidden">
            {/* Sidebar */}
            <aside className="w-64 flex-shrink-0 border-r border-neutral-200 dark:border-neutral-800 flex flex-col hidden md:flex bg-white dark:bg-neutral-900">
              <div className="p-3 flex-1 overflow-y-auto">
                <button
                  onClick={() => { setPlayingVideo(null); setViewingChannel(null); }}
                  className="w-full flex items-center gap-4 px-3 py-2.5 rounded-lg bg-neutral-100 dark:bg-neutral-800 font-medium"
                >
                  <HomeIcon /> Home
                </button>
                <button className="w-full flex items-center gap-4 px-3 py-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors mt-1">
                  <SubsIcon /> Subscriptions
                </button>
               
                <div className="my-3 border-t border-neutral-200 dark:border-neutral-800"></div>
               
                <button className="w-full flex items-center gap-4 px-3 py-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors mt-1">
                  <VideoIcon /> Library
                </button>
                <button className="w-full flex items-center gap-4 px-3 py-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors mt-1">
                  <HistoryIcon /> History
                </button>
                <button className="w-full flex items-center gap-4 px-3 py-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors mt-1">
                  <LikeOutlineIcon /> Liked Videos
                </button>
              </div>
             
              {/* Copyright Section added as requested */}
              <div className="p-4 border-t border-neutral-200 dark:border-neutral-800">
                <div className="text-xs text-neutral-500 font-medium leading-relaxed">
                  © Brians Games<br />
                  Made by Brian Pitt
                </div>
              </div>
            </aside>

            {/* Content Area */}
            <main className="flex-1 overflow-y-auto bg-neutral-50 dark:bg-[#0f0f0f]">
              {playingVideo ? (
                // Video Player View
                <div className="max-w-7xl mx-auto p-4 sm:p-6 lg:flex gap-6">
                  <div className="flex-1">
                    <div className="w-full aspect-video bg-black rounded-xl overflow-hidden shadow-lg relative">
                      {playingVideo.isEmbed ? (
                        <iframe
                          src={playingVideo.embedUrl}
                          className="w-full h-full"
                          frameBorder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                          allowFullScreen
                        />
                      ) : playingVideo.videoUrl ? (
                        <video src={playingVideo.videoUrl} controls autoPlay className="w-full h-full object-contain"></video>
                      ) : (
                        <div className="w-full h-full flex flex-col items-center justify-center text-white/50">
                          <PlayIcon className="w-16 h-16 mb-4 opacity-50" />
                          <p>Mock Video Player</p>
                        </div>
                      )}
                    </div>
                    <h1 className="text-xl sm:text-2xl font-bold mt-4">{playingVideo.title}</h1>
                    <div className="flex flex-wrap items-center justify-between gap-4 mt-3 pb-4 border-b border-neutral-200 dark:border-neutral-800">
                      <div className="flex items-center gap-3">
                        <div
                          className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold shadow-sm cursor-pointer"
                          onClick={() => { setViewingChannel(playingVideo.channel); setPlayingVideo(null); }}
                        >
                          {playingVideo.channel.charAt(0)}
                        </div>
                        <div
                          className="cursor-pointer group"
                          onClick={() => { setViewingChannel(playingVideo.channel); setPlayingVideo(null); }}
                        >
                          <div className="font-bold text-sm sm:text-base group-hover:text-blue-500 transition-colors">{playingVideo.channel}</div>
                          <div className="text-xs text-neutral-500">1.2M subscribers</div>
                        </div>
                        <button className="ml-4 bg-black dark:bg-white text-white dark:text-black px-4 py-2 rounded-full font-medium text-sm hover:opacity-90 transition-opacity">
                          Subscribe
                        </button>
                      </div>
                     
                      <div className="flex items-center gap-2">
                        <div className="flex bg-neutral-100 dark:bg-neutral-800 rounded-full overflow-hidden">
                          <button onClick={handleLike} className="flex items-center gap-2 px-4 py-2 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors border-r border-neutral-200 dark:border-neutral-700">
                            <ThumbUpIcon /> <span className="text-sm font-medium">{playingVideo.likes}</span>
                          </button>
                          <button className="px-4 py-2 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors">
                            <ThumbDownIcon />
                          </button>
                        </div>
                        <button className="flex items-center gap-2 px-4 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors rounded-full">
                          <ShareIcon /> <span className="text-sm font-medium hidden sm:block">Share</span>
                        </button>
                      </div>
                    </div>
                    <div className="mt-4 bg-neutral-100 dark:bg-neutral-800 rounded-xl p-4 text-sm whitespace-pre-wrap">
                      <span className="font-bold">{playingVideo.views} • {formatTimeAgo(playingVideo.createdAt)}</span><br/><br/>
                      {playingVideo.desc || "No description provided for this video."}
                    </div>

                    {/* Comments Section */}
                    <div className="mt-6">
                      <h3 className="font-bold text-lg mb-4">{playingVideo.comments.length} Comments</h3>
                      <form onSubmit={handleAddComment} className="flex gap-4 mb-6">
                        <div className="w-10 h-10 rounded-full bg-blue-600 flex-shrink-0 flex items-center justify-center text-white font-bold shadow-sm">
                          BP
                        </div>
                        <div className="flex-1 flex flex-col items-end gap-2">
                          <input
                            type="text"
                            value={newComment}
                            onChange={(e) => setNewComment(e.target.value)}
                            placeholder="Add a comment..."
                            className="w-full bg-transparent border-b border-neutral-300 dark:border-neutral-700 focus:border-neutral-900 dark:focus:border-white outline-none py-1 transition-colors"
                          />
                          {newComment && (
                            <button type="submit" className="px-4 py-1.5 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 transition-colors">
                              Comment
                            </button>
                          )}
                        </div>
                      </form>
                      <div className="flex flex-col gap-5">
                        {playingVideo.comments.map(comment => (
                          <div key={comment.id} className="flex gap-3">
                            <div className="w-10 h-10 rounded-full bg-neutral-300 dark:bg-neutral-700 flex-shrink-0 flex items-center justify-center text-neutral-600 dark:text-neutral-300 font-bold text-sm">
                              {comment.user.charAt(0)}
                            </div>
                            <div>
                              <div className="flex items-center gap-2">
                                <span className="font-bold text-sm">{comment.user}</span>
                                <span className="text-xs text-neutral-500">{formatTimeAgo(comment.createdAt)}</span>
                              </div>
                              <p className="text-sm mt-1">{comment.text}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                 
                  {/* Recommended Side list */}
                  <div className="lg:w-[350px] xl:w-[400px] mt-8 lg:mt-0 flex flex-col gap-3">
                    <h3 className="font-bold text-lg mb-2">Up next</h3>
                    {videos.filter(v => v.id !== playingVideo.id).map(video => (
                      <div
                        key={video.id}
                        className="flex gap-2 cursor-pointer group"
                        onClick={() => setPlayingVideo(video)}
                      >
                        <div className="w-40 aspect-video rounded-lg overflow-hidden flex-shrink-0 bg-neutral-200 dark:bg-neutral-800">
                          <img src={video.thumb} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
                        </div>
                        <div className="flex flex-col py-1">
                          <span className="font-medium text-sm line-clamp-2 leading-tight group-hover:text-blue-500 transition-colors">{video.title}</span>
                          <span className="text-xs text-neutral-500 mt-1">{video.channel}</span>
                          <span className="text-xs text-neutral-500">{video.views} • {formatTimeAgo(video.createdAt)}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              ) : (
                <div className="flex flex-col">
                  {/* Channel Header (if viewing a specific channel) */}
                  {viewingChannel && (
                    <div className="bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 p-6 sm:p-8 flex items-center gap-4 sm:gap-6">
                      <div className="w-16 h-16 sm:w-24 sm:h-24 rounded-full bg-blue-600 text-white flex items-center justify-center text-3xl sm:text-5xl font-bold shadow-md">
                        {viewingChannel.charAt(0)}
                      </div>
                      <div>
                        <h1 className="text-2xl sm:text-4xl font-bold">{viewingChannel}</h1>
                        <p className="text-sm sm:text-base text-neutral-500 mt-1">{filteredVideos.length} videos</p>
                      </div>
                    </div>
                  )}

                  {/* Categories Bar */}
                  {!viewingChannel && (
                    <div className="flex items-center gap-3 p-4 border-b border-neutral-200 dark:border-neutral-800 overflow-x-auto sticky top-0 bg-neutral-50/90 dark:bg-[#0f0f0f]/90 backdrop-blur-sm z-10">
                      {categories.map(cat => (
                        <button
                          key={cat}
                          onClick={() => setActiveCategory(cat)}
                          className={`px-3 py-1.5 rounded-lg whitespace-nowrap text-sm font-medium transition-colors ${activeCategory === cat ? 'bg-black text-white dark:bg-white dark:text-black' : 'bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700'}`}
                        >
                          {cat}
                        </button>
                      ))}
                    </div>
                  )}

                  {/* Video Grid View */}
                  <div className="p-4 sm:p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-8">
                    {videos.length === 0 ? (
                      <div className="col-span-full flex flex-col items-center justify-center text-neutral-500 py-20">
                        <p className="text-xl font-medium mb-2 text-neutral-900 dark:text-white">No videos.</p>
                        <p className="mb-6">Would you like to add some?</p>
                        <button
                          onClick={() => setIsUploadOpen(true)}
                          className="px-6 py-2 bg-blue-600 text-white font-medium rounded-full hover:bg-blue-700 transition-colors shadow-sm"
                        >
                          Upload Video
                        </button>
                      </div>
                    ) : filteredVideos.length === 0 ? (
                      <div className="col-span-full text-center text-neutral-500 py-12">
                        No videos found matching "{searchQuery}" {activeCategory !== "All" && `in ${activeCategory}`}
                      </div>
                    ) : (
                      filteredVideos.map(video => (
                        <div
                          key={video.id}
                          className="flex flex-col gap-3 cursor-pointer group"
                          onClick={() => setPlayingVideo(video)}
                        >
                          <div className="w-full aspect-video rounded-xl overflow-hidden bg-neutral-200 dark:bg-neutral-800 relative">
                            <img src={video.thumb} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
                            <div className="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded font-medium">
                              10:24
                            </div>
                          </div>
                          <div className="flex gap-3">
                            <div
                              className="w-9 h-9 rounded-full bg-blue-600 flex-shrink-0 flex items-center justify-center text-white font-bold text-sm cursor-pointer"
                              onClick={(e) => { e.stopPropagation(); setViewingChannel(video.channel); setPlayingVideo(null); }}
                            >
                              {video.channel.charAt(0)}
                            </div>
                            <div className="flex flex-col">
                              <h3 className="font-semibold text-sm line-clamp-2 group-hover:text-blue-500 transition-colors">{video.title}</h3>
                              <span
                                className="text-sm text-neutral-500 mt-1 hover:text-neutral-900 dark:hover:text-white transition-colors cursor-pointer"
                                onClick={(e) => { e.stopPropagation(); setViewingChannel(video.channel); setPlayingVideo(null); }}
                              >
                                {video.channel}
                              </span>
                              <span className="text-sm text-neutral-500">{video.views} • {formatTimeAgo(video.createdAt)}</span>
                            </div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              )}
            </main>
          </div>

          {/* Upload Modal (Using the exact logic/snippet structure provided) */}
          {isUploadOpen && (
            <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 modal-enter-active">
              <div className="bg-white dark:bg-neutral-900 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                <div className="px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex justify-between items-center bg-neutral-50 dark:bg-neutral-900/50">
                  <h2 className="text-xl font-bold">Upload Local Video</h2>
                  <button onClick={() => setIsUploadOpen(false)} className="text-neutral-500 hover:text-neutral-800 dark:hover:text-white transition-colors">
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
                </div>
               
                <div className="p-6 overflow-y-auto">
                  <form onSubmit={handleUploadSubmit}>
                    <div className="mb-4">
                      <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300">Video Source</label>
                      <div className="flex gap-5">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input type="radio" name="upType" checked={uploadType === 'link'} onChange={() => setUploadType('link')} className="cursor-pointer" />
                          <span className="text-sm font-medium text-neutral-700 dark:text-neutral-300">Video URL (Saves to Cloud)</span>
                        </label>
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input type="radio" name="upType" checked={uploadType === 'file'} onChange={() => setUploadType('file')} className="cursor-pointer" />
                          <span className="text-sm font-medium text-neutral-700 dark:text-neutral-300">Local File (Temporary)</span>
                        </label>
                      </div>
                    </div>

                    {uploadType === 'link' ? (
                      <div className="mb-4">
                        <label className="block text-sm font-medium mb-1.5 text-neutral-700 dark:text-neutral-300">Video URL</label>
                        <input
                          type="url"
                          value={upUrl}
                          onChange={(e) => setUpUrl(e.target.value)}
                          placeholder="e.g. YouTube or Google Drive link"
                          className="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-neutral-50 dark:bg-neutral-800 focus:border-blue-500 outline-none transition-colors"
                          required={uploadType === 'link'}
                        />
                      </div>
                    ) : (
                      <div className="mb-4">
                        <label className="block text-sm font-medium mb-1.5 text-neutral-700 dark:text-neutral-300">Video File</label>
                        <input
                          type="file"
                          accept="video/*"
                          onChange={(e) => setUpFile(e.target.files[0])}
                          className="w-full text-sm text-neutral-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-neutral-800 dark:file:text-neutral-300"
                          required={uploadType === 'file'}
                        />
                      </div>
                    )}
                   
                    <div className="mb-4">
                      <label className="block text-sm font-medium mb-1.5 text-neutral-700 dark:text-neutral-300">Title</label>
                      <input
                        type="text"
                        value={upTitle}
                        onChange={(e) => setUpTitle(e.target.value)}
                        placeholder="Add a title that describes your video"
                        className="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-neutral-50 dark:bg-neutral-800 focus:border-blue-500 outline-none transition-colors"
                        required
                      />
                    </div>

                    <div className="mb-4">
                      <label className="block text-sm font-medium mb-1.5 text-neutral-700 dark:text-neutral-300">Original Channel Name</label>
                      <input
                        type="text"
                        value={upChannel}
                        onChange={(e) => setUpChannel(e.target.value)}
                        placeholder="Who originally made this video?"
                        className="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-neutral-50 dark:bg-neutral-800 focus:border-blue-500 outline-none transition-colors"
                        required
                      />
                    </div>

                    <div className="mb-4">
                      <label className="block text-sm font-medium mb-1.5 text-neutral-700 dark:text-neutral-300">Description</label>
                      <textarea
                        value={upDesc}
                        onChange={(e) => setUpDesc(e.target.value)}
                        placeholder="Tell viewers about your video..."
                        rows="3"
                        className="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-neutral-50 dark:bg-neutral-800 focus:border-blue-500 outline-none resize-none transition-colors"
                      ></textarea>
                    </div>

                    <div className="mt-4 flex justify-end gap-3">
                      <button
                        type="button"
                        onClick={() => setIsUploadOpen(false)}
                        className="px-5 py-2 font-medium hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors active:scale-[0.98]"
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        className="px-5 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors active:scale-[0.98]"
                      >
                        Save Video
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
